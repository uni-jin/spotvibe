# 지도 메뉴 선택 시 검정 화면만 노출 — 원인 분석 보고

## 현상
지도 메뉴를 선택하면 지도 타일 없이 **검정색 화면만** 보이는 현상.

---

## 원인 후보 (가능성 순)

### 1. Leaflet 컨테이너 크기 미계산 (가장 유력)

**설명**  
지도 뷰는 **피드/디스커버 등 다른 뷰에서 탭으로 전환될 때만** 처음 마운트됩니다. 이때:

- `MapContainer`가 DOM에 들어오는 시점에 **부모 레이아웃이 아직 반영되지 않았을 수 있음**
- Leaflet이 초기화될 때 컨테이너의 **width/height를 0으로 인식**
- 크기가 0이면 타일을 요청하지 않거나, 타일 팬이 그려지지 않음
- 배경만 CSS로 `#000`이라 **검정 화면만 보임**

**근거**  
- `index.css`: `.dark-map .leaflet-container { background-color: #000; }`  
- react-leaflet/Leaflet 문서에서도 “숨겨졌다가 보이는 컨테이너”에서는 `map.invalidateSize()` 호출을 권장

**권장 대응**  
지도가 보이는 시점에 한 번 `map.invalidateSize()`를 호출해, Leaflet이 컨테이너 크기를 다시 계산하고 타일을 요청하도록 함.

---

### 2. 지도 메뉴 클릭 시 실제로는 “지도”가 아닌 다른 화면이 보이는 경우

**설명**  
`handleNavClick`에서 **지역(selectedRegion)이 없으면** feed/discover/**map** 모두 **홈(지역 선택 화면)**으로 보냅니다.

```js
// App.jsx
if ((viewId === 'feed' || viewId === 'discover' || viewId === 'map') && !selectedRegion) {
  setCurrentView('home')  // 지도가 아니라 홈으로 이동
} else {
  setCurrentView(viewId)
}
```

- 지역을 선택하지 않고 지도 탭만 누르면 → **홈(지역 선택) 화면**으로 이동
- 홈도 `bg-black`이라, 지역 카드가 로딩 느리거나 가려지면 **검정만 보인 것처럼** 느낄 수 있음

**확인 방법**  
지역을 한 번 선택한 뒤 다시 지도 탭을 눌렀을 때도 검정이면 → 1번(Leaflet 크기) 쪽이 주원인일 가능성이 큼.

---

### 3. 타일 URL / 네트워크 이슈

**설명**  
- OSM 타일: `https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png`
- 이 요청이 실패하거나(CORS, 차단, 오프라인) 지연되면 타일이 비어 있고 배경만 검정으로 보일 수 있음

**확인 방법**  
개발자 도구 Network 탭에서 `tile.openstreetmap.org` 요청이 나가는지, 200으로 응답하는지 확인.

---

### 4. CSS로 타일/팬이 가려지거나 크기 0인 경우

**설명**  
- `index.css`에서 `.dark-map .leaflet-tile-pane` 등에 `height: 100%` 등이 있음
- 부모 높이가 0이면 타일 팬도 0이 되어 타일이 안 그려질 수 있음  
→ 결국 **1번(컨테이너 크기 0)**과 같은 결과

---

## 요약

| 원인 | 가능성 | 확인/대응 |
|------|--------|-----------|
| Leaflet이 컨테이너 크기를 0으로 인식해 타일 미요청 | 높음 | 지도 표시 시 `invalidateSize()` 호출로 수정 권장 |
| 지역 미선택으로 홈으로 이동, 홈이 검정으로 보임 | 중간 | 지역 선택 후 지도 탭 다시 테스트 |
| 타일 네트워크/CORS 실패 | 낮음 | Network 탭에서 OSM 요청 확인 |
| CSS로 인한 타일/팬 0 크기 | 1번과 연동 | 1번 대응으로 함께 해소 가능 |

**권장 조치**  
지도 뷰가 마운트된 뒤(지도가 보이기 시작할 때) **한 번 `map.invalidateSize()`를 호출**하는 로직을 추가하는 것을 권장합니다. 이렇게 하면 탭 전환 후에도 Leaflet이 올바른 크기로 타일을 요청해, 검정 화면만 나오는 문제가 대부분 해결됩니다.
